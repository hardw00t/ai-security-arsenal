# Frida iOS Code Snippets

Common Frida scripts for iOS penetration testing.

## Basic Setup

### Check if Objective-C is available
```javascript
if (ObjC.available) {
    console.log("Objective-C runtime available");
} else {
    console.log("Objective-C runtime NOT available");
}
```

### List all classes
```javascript
for (var className in ObjC.classes) {
    console.log(className);
}
```

### Search classes by name
```javascript
for (var className in ObjC.classes) {
    if (className.toLowerCase().includes("auth")) {
        console.log(className);
    }
}
```

### List methods of a class
```javascript
var methods = ObjC.classes.ClassName.$ownMethods;
methods.forEach(function(method) {
    console.log(method);
});
```

---

## Method Hooking

### Hook instance method
```javascript
var ClassName = ObjC.classes.ClassName;
Interceptor.attach(ClassName['- methodName:'].implementation, {
    onEnter: function(args) {
        console.log("Method called");
        // args[0] = self, args[1] = _cmd, args[2+] = actual arguments
        var arg1 = new ObjC.Object(args[2]);
        console.log("Arg1: " + arg1);
    },
    onLeave: function(retval) {
        console.log("Return: " + retval);
    }
});
```

### Hook class method
```javascript
var ClassName = ObjC.classes.ClassName;
Interceptor.attach(ClassName['+ classMethod'].implementation, {
    onEnter: function(args) {
        console.log("Class method called");
    }
});
```

### Modify return value
```javascript
Interceptor.attach(ClassName['- method'].implementation, {
    onLeave: function(retval) {
        retval.replace(1);  // Replace with YES/true
    }
});
```

### Replace method implementation
```javascript
ClassName['- method'].implementation = function() {
    console.log("Method replaced");
    return 1;  // Return YES
};
```

---

## Working with ObjC Objects

### Create NSString
```javascript
var str = ObjC.classes.NSString.stringWithString_("Hello");
```

### Create NSDictionary
```javascript
var keys = ObjC.classes.NSArray.arrayWithObjects_("key1", "key2", null);
var values = ObjC.classes.NSArray.arrayWithObjects_("value1", "value2", null);
var dict = ObjC.classes.NSDictionary.dictionaryWithObjects_forKeys_(values, keys);
```

### Read NSData as string
```javascript
var nsdata = new ObjC.Object(ptr);
var str = nsdata.bytes().readUtf8String(nsdata.length());
```

### Convert ObjC object to string
```javascript
var obj = new ObjC.Object(args[2]);
console.log(obj.toString());
```

---

## Keychain Operations

### Hook all keychain operations
```javascript
["SecItemAdd", "SecItemCopyMatching", "SecItemUpdate", "SecItemDelete"].forEach(function(func) {
    var f = Module.findExportByName("Security", func);
    Interceptor.attach(f, {
        onEnter: function(args) {
            console.log("[" + func + "]");
            console.log("Query: " + new ObjC.Object(args[0]));
        },
        onLeave: function(retval) {
            console.log("Result: " + retval);
        }
    });
});
```

---

## Network Hooks

### Hook NSURLSession requests
```javascript
var NSURLSession = ObjC.classes.NSURLSession;
Interceptor.attach(NSURLSession['- dataTaskWithRequest:completionHandler:'].implementation, {
    onEnter: function(args) {
        var request = new ObjC.Object(args[2]);
        console.log("URL: " + request.URL());
        console.log("Method: " + request.HTTPMethod());
        console.log("Headers: " + request.allHTTPHeaderFields());
    }
});
```

### Hook URLSession delegate
```javascript
var resolver = new ApiResolver('objc');
resolver.enumerateMatches('-[* URLSession:dataTask:didReceiveData:]').forEach(function(match) {
    Interceptor.attach(match.address, {
        onEnter: function(args) {
            var data = new ObjC.Object(args[4]);
            console.log("Received data length: " + data.length());
        }
    });
});
```

---

## File System

### Hook file operations
```javascript
var fopen = Module.findExportByName(null, "fopen");
Interceptor.attach(fopen, {
    onEnter: function(args) {
        console.log("fopen: " + args[0].readUtf8String());
    }
});
```

### Hook NSFileManager
```javascript
var NSFileManager = ObjC.classes.NSFileManager;
Interceptor.attach(NSFileManager['- contentsAtPath:'].implementation, {
    onEnter: function(args) {
        var path = new ObjC.Object(args[2]);
        console.log("Reading file: " + path);
    }
});
```

---

## Biometric / LAContext

### Hook biometric authentication
```javascript
var LAContext = ObjC.classes.LAContext;
Interceptor.attach(LAContext['- evaluatePolicy:localizedReason:reply:'].implementation, {
    onEnter: function(args) {
        console.log("Biometric auth requested");
        var reply = new ObjC.Block(args[4]);
        reply.implementation(true, null);  // Simulate success
    }
});
```

---

## Memory Search

### Search for string in memory
```javascript
Process.enumerateRanges('r--').forEach(function(range) {
    Memory.scanSync(range.base, range.size, "pattern").forEach(function(match) {
        console.log("Found at: " + match.address);
    });
});
```

### Search for ASCII string
```javascript
var pattern = "password";
var results = Memory.scanSync(ptr(0), Process.pageSize * 1000, pattern);
```

---

## Useful Patterns

### Log all method calls to a class
```javascript
function traceClass(className) {
    var clazz = ObjC.classes[className];
    clazz.$ownMethods.forEach(function(method) {
        Interceptor.attach(clazz[method].implementation, {
            onEnter: function(args) {
                console.log(className + " " + method);
            }
        });
    });
}
traceClass("AuthManager");
```

### Find and hook by method name pattern
```javascript
for (var className in ObjC.classes) {
    var methods = ObjC.classes[className].$ownMethods;
    methods.forEach(function(method) {
        if (method.includes("password")) {
            console.log(className + " " + method);
        }
    });
}
```

### Get instance of singleton
```javascript
var instance = ObjC.classes.SingletonClass.sharedInstance();
console.log(instance.someProperty());
```

---

## ObjC Blocks

### Call an ObjC block
```javascript
var block = new ObjC.Block(args[3]);
block.implementation(true, null);  // Call with arguments
```

### Create custom block
```javascript
var block = new ObjC.Block({
    retType: 'void',
    argTypes: ['bool', 'object'],
    implementation: function(success, error) {
        console.log("Block called: " + success);
    }
});
```

---

## Debugging Tips

### Print backtrace
```javascript
console.log(Thread.backtrace(this.context, Backtracer.ACCURATE)
    .map(DebugSymbol.fromAddress).join('\n'));
```

### Get module list
```javascript
Process.enumerateModules().forEach(function(mod) {
    console.log(mod.name + " @ " + mod.base);
});
```

### Find exported function
```javascript
var func = Module.findExportByName("libSystem.B.dylib", "open");
console.log("open @ " + func);
```
