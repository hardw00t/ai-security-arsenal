<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ report.title }} - Technical Report</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="report-header">
            <h1>{{ report.title }}</h1>
            <p class="subtitle">Technical Security Assessment Report</p>

            <div class="report-meta">
                <div class="report-meta-item">
                    <div class="label">Client</div>
                    <div class="value">{{ report.client_name }}</div>
                </div>
                <div class="report-meta-item">
                    <div class="label">Application</div>
                    <div class="value">{{ report.app_name }} v{{ report.app_version }}</div>
                </div>
                <div class="report-meta-item">
                    <div class="label">Package</div>
                    <div class="value">{{ report.package_name }}</div>
                </div>
                <div class="report-meta-item">
                    <div class="label">Assessment Period</div>
                    <div class="value">{{ report.assessment_start }} - {{ report.assessment_end }}</div>
                </div>
                <div class="report-meta-item">
                    <div class="label">Assessor</div>
                    <div class="value">{{ report.assessor }}</div>
                </div>
                <div class="report-meta-item">
                    <div class="label">Report Version</div>
                    <div class="value">{{ report.version }}</div>
                </div>
            </div>
        </header>

        <!-- Table of Contents -->
        <nav class="toc">
            <h3>Table of Contents</h3>
            <ul>
                <li><a href="#executive-summary">1. Executive Summary <span class="page-num"></span></a></li>
                <li><a href="#methodology">2. Methodology <span class="page-num"></span></a></li>
                <li><a href="#scope">3. Scope <span class="page-num"></span></a></li>
                <li><a href="#summary">4. Findings Summary <span class="page-num"></span></a></li>
                <li><a href="#findings">5. Detailed Findings <span class="page-num"></span></a></li>
                {% for finding in report.findings %}
                <li style="padding-left: 1rem;"><a href="#finding-{{ finding.id }}">5.{{ loop.index }}. {{ finding.title }} <span class="page-num"></span></a></li>
                {% endfor %}
                <li><a href="#recommendations">6. Recommendations <span class="page-num"></span></a></li>
                <li><a href="#appendix">7. Appendix <span class="page-num"></span></a></li>
            </ul>
        </nav>

        <!-- Executive Summary -->
        <section id="executive-summary">
            <h2>1. Executive Summary</h2>

            <div class="executive-summary">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg);">
                    <div>
                        <h3 style="margin-bottom: var(--spacing-xs);">Overall Risk Level</h3>
                        <span class="risk-score {{ report.risk_level|lower }}">{{ report.risk_level }}</span>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 3rem; font-weight: 700;">{{ report.total_findings }}</div>
                        <div style="color: var(--color-text-secondary);">Total Findings</div>
                    </div>
                </div>

                <p>{{ report.executive_summary }}</p>

                <div class="stats-grid">
                    <div class="stat-card critical">
                        <div class="stat-value">{{ report.summary.critical }}</div>
                        <div class="stat-label">Critical</div>
                    </div>
                    <div class="stat-card high">
                        <div class="stat-value">{{ report.summary.high }}</div>
                        <div class="stat-label">High</div>
                    </div>
                    <div class="stat-card medium">
                        <div class="stat-value">{{ report.summary.medium }}</div>
                        <div class="stat-label">Medium</div>
                    </div>
                    <div class="stat-card low">
                        <div class="stat-value">{{ report.summary.low }}</div>
                        <div class="stat-label">Low</div>
                    </div>
                    <div class="stat-card info">
                        <div class="stat-value">{{ report.summary.info }}</div>
                        <div class="stat-label">Informational</div>
                    </div>
                </div>
            </div>

            <div class="charts-container">
                <div class="chart-wrapper">
                    <h4>Findings by Severity</h4>
                    <canvas id="severityChart"></canvas>
                </div>
                <div class="chart-wrapper">
                    <h4>Findings by Category</h4>
                    <canvas id="categoryChart"></canvas>
                </div>
            </div>
        </section>

        <div class="page-break"></div>

        <!-- Methodology -->
        <section id="methodology">
            <h2>2. Methodology</h2>

            <p>This security assessment was conducted following industry-standard methodologies for mobile application penetration testing:</p>

            <h3>2.1 Testing Standards</h3>
            <ul>
                <li><strong>OWASP MASTG</strong> - Mobile Application Security Testing Guide</li>
                <li><strong>OWASP MASVS</strong> - Mobile Application Security Verification Standard</li>
                <li><strong>CVSS 3.1</strong> - Common Vulnerability Scoring System</li>
            </ul>

            <h3>2.2 Testing Phases</h3>
            <table>
                <thead>
                    <tr>
                        <th>Phase</th>
                        <th>Description</th>
                        <th>Tools Used</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Reconnaissance</td>
                        <td>Information gathering and attack surface mapping</td>
                        <td>APKTool, JADX, ADB</td>
                    </tr>
                    <tr>
                        <td>Static Analysis</td>
                        <td>Code review and configuration analysis</td>
                        <td>MobSF, JADX, Android Studio</td>
                    </tr>
                    <tr>
                        <td>Dynamic Analysis</td>
                        <td>Runtime testing and instrumentation</td>
                        <td>Frida, Objection, ADB</td>
                    </tr>
                    <tr>
                        <td>Network Testing</td>
                        <td>Traffic analysis and API testing</td>
                        <td>Burp Suite, mitmproxy</td>
                    </tr>
                    <tr>
                        <td>Exploitation</td>
                        <td>Vulnerability validation and impact assessment</td>
                        <td>Custom scripts, Frida</td>
                    </tr>
                </tbody>
            </table>

            <h3>2.3 Testing Categories</h3>
            <table>
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>MASVS Reference</th>
                        <th>Tests Performed</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>Data Storage</td><td>MASVS-STORAGE</td><td>Local storage, databases, logs, backups</td></tr>
                    <tr><td>Cryptography</td><td>MASVS-CRYPTO</td><td>Algorithm strength, key management, random numbers</td></tr>
                    <tr><td>Authentication</td><td>MASVS-AUTH</td><td>Login flows, session management, biometrics</td></tr>
                    <tr><td>Network</td><td>MASVS-NETWORK</td><td>TLS configuration, certificate pinning, API security</td></tr>
                    <tr><td>Platform</td><td>MASVS-PLATFORM</td><td>IPC, WebViews, permissions, deep links</td></tr>
                    <tr><td>Code Quality</td><td>MASVS-CODE</td><td>Input validation, error handling, debugging</td></tr>
                    <tr><td>Resilience</td><td>MASVS-RESILIENCE</td><td>Root detection, tampering, reverse engineering</td></tr>
                    <tr><td>Privacy</td><td>MASVS-PRIVACY</td><td>Data collection, tracking, permissions</td></tr>
                </tbody>
            </table>
        </section>

        <div class="page-break"></div>

        <!-- Scope -->
        <section id="scope">
            <h2>3. Scope</h2>

            <h3>3.1 Application Details</h3>
            <table>
                <tr><td><strong>Application Name</strong></td><td>{{ report.app_name }}</td></tr>
                <tr><td><strong>Package Name</strong></td><td>{{ report.package_name }}</td></tr>
                <tr><td><strong>Version</strong></td><td>{{ report.app_version }}</td></tr>
                <tr><td><strong>Target SDK</strong></td><td>{{ report.target_sdk }}</td></tr>
                <tr><td><strong>Min SDK</strong></td><td>{{ report.min_sdk }}</td></tr>
            </table>

            <h3>3.2 Test Environment</h3>
            <table>
                <tr><td><strong>Device</strong></td><td>{{ report.test_device }}</td></tr>
                <tr><td><strong>Android Version</strong></td><td>{{ report.android_version }}</td></tr>
                <tr><td><strong>Root Status</strong></td><td>{{ report.root_status }}</td></tr>
            </table>

            <h3>3.3 In Scope</h3>
            <ul>
                {% for item in report.scope.included %}
                <li>{{ item }}</li>
                {% endfor %}
            </ul>

            {% if report.scope.excluded %}
            <h3>3.4 Out of Scope</h3>
            <ul>
                {% for item in report.scope.excluded %}
                <li>{{ item }}</li>
                {% endfor %}
            </ul>
            {% endif %}
        </section>

        <div class="page-break"></div>

        <!-- Findings Summary -->
        <section id="summary">
            <h2>4. Findings Summary</h2>

            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Title</th>
                        <th>Severity</th>
                        <th>CVSS</th>
                        <th>Category</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for finding in report.findings %}
                    <tr>
                        <td><a href="#finding-{{ finding.id }}">{{ finding.id }}</a></td>
                        <td>{{ finding.title }}</td>
                        <td><span class="severity-badge {{ finding.severity }}">{{ finding.severity }}</span></td>
                        <td>{{ finding.cvss.score if finding.cvss else 'N/A' }}</td>
                        <td>{{ finding.category }}</td>
                        <td>{{ finding.status | default('Open') }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>

        <div class="page-break"></div>

        <!-- Detailed Findings -->
        <section id="findings">
            <h2>5. Detailed Findings</h2>

            {% for finding in report.findings %}
            {% include 'finding_card.html.jinja2' %}
            {% endfor %}
        </section>

        <div class="page-break"></div>

        <!-- Recommendations -->
        <section id="recommendations">
            <h2>6. Recommendations</h2>

            <h3>6.1 Immediate Actions (Critical & High)</h3>
            <ol>
                {% for rec in report.immediate_recommendations %}
                <li>{{ rec }}</li>
                {% endfor %}
            </ol>

            <h3>6.2 Short-term Actions (Medium)</h3>
            <ol>
                {% for rec in report.shortterm_recommendations %}
                <li>{{ rec }}</li>
                {% endfor %}
            </ol>

            <h3>6.3 Long-term Improvements</h3>
            <ol>
                {% for rec in report.longterm_recommendations %}
                <li>{{ rec }}</li>
                {% endfor %}
            </ol>
        </section>

        <!-- Appendix -->
        <section id="appendix">
            <h2>7. Appendix</h2>

            <h3>A. CVSS 3.1 Scoring Reference</h3>
            <table>
                <thead>
                    <tr>
                        <th>Score Range</th>
                        <th>Severity</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>9.0 - 10.0</td><td class="severity-badge critical">Critical</td><td>Immediate exploitation likely with severe impact</td></tr>
                    <tr><td>7.0 - 8.9</td><td class="severity-badge high">High</td><td>Exploitation possible with significant impact</td></tr>
                    <tr><td>4.0 - 6.9</td><td class="severity-badge medium">Medium</td><td>Exploitation requires specific conditions</td></tr>
                    <tr><td>0.1 - 3.9</td><td class="severity-badge low">Low</td><td>Limited impact or difficult exploitation</td></tr>
                    <tr><td>0.0</td><td class="severity-badge info">Info</td><td>Informational, no direct security impact</td></tr>
                </tbody>
            </table>

            <h3>B. References</h3>
            <ul>
                <li><a href="https://mas.owasp.org/">OWASP Mobile Application Security</a></li>
                <li><a href="https://developer.android.com/training/articles/security-tips">Android Security Best Practices</a></li>
                <li><a href="https://www.first.org/cvss/calculator/3.1">CVSS 3.1 Calculator</a></li>
            </ul>

            {% if report.timeline %}
            <h3>C. Testing Timeline</h3>
            <div class="timeline">
                {% for event in report.timeline %}
                <div class="timeline-event">
                    <div class="event-time">{{ event.timestamp }}</div>
                    <div class="event-description">{{ event.description }}</div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </section>

        <!-- Footer -->
        <footer class="report-footer">
            <p><strong>CONFIDENTIAL</strong> - {{ report.client_name }}</p>
            <p>This document contains sensitive security information and should be handled accordingly.</p>
            <p>Report generated: {{ report.generated_date }}</p>
        </footer>
    </div>

    <script>
        // Severity Chart
        const severityCtx = document.getElementById('severityChart').getContext('2d');
        new Chart(severityCtx, {
            type: 'doughnut',
            data: {
                labels: ['Critical', 'High', 'Medium', 'Low', 'Info'],
                datasets: [{
                    data: [{{ report.summary.critical }}, {{ report.summary.high }}, {{ report.summary.medium }}, {{ report.summary.low }}, {{ report.summary.info }}],
                    backgroundColor: ['#8B0000', '#FF4500', '#FFA500', '#4169E1', '#808080'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });

        // Category Chart
        const categoryCtx = document.getElementById('categoryChart').getContext('2d');
        new Chart(categoryCtx, {
            type: 'bar',
            data: {
                labels: {{ report.category_labels | tojson }},
                datasets: [{
                    label: 'Findings',
                    data: {{ report.category_values | tojson }},
                    backgroundColor: '#1a73e8'
                }]
            },
            options: {
                responsive: true,
                indexAxis: 'y',
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    x: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>
