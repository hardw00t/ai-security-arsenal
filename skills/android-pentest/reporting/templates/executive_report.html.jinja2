<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ report.title }} - Executive Summary</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Additional inline styles for executive report */
        .key-findings {
            margin: var(--spacing-xl) 0;
        }
        .key-finding {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            background: white;
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
            border-left: 4px solid var(--color-border);
        }
        .key-finding.critical { border-left-color: var(--color-critical); }
        .key-finding.high { border-left-color: var(--color-high); }
        .recommendation-list {
            counter-reset: recommendation;
        }
        .recommendation-item {
            display: flex;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            background: var(--color-surface);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-sm);
        }
        .recommendation-item::before {
            counter-increment: recommendation;
            content: counter(recommendation);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: var(--color-primary);
            color: white;
            border-radius: 50%;
            font-weight: 600;
            font-size: 0.85rem;
            flex-shrink: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="report-header">
            <h1>{{ report.title }}</h1>
            <p class="subtitle">Executive Summary - Android Penetration Test</p>

            <div class="report-meta">
                <div class="report-meta-item">
                    <div class="label">Client</div>
                    <div class="value">{{ report.client_name }}</div>
                </div>
                <div class="report-meta-item">
                    <div class="label">Application</div>
                    <div class="value">{{ report.app_name }} v{{ report.app_version }}</div>
                </div>
                <div class="report-meta-item">
                    <div class="label">Package</div>
                    <div class="value">{{ report.package_name }}</div>
                </div>
                <div class="report-meta-item">
                    <div class="label">Assessment Date</div>
                    <div class="value">{{ report.assessment_date }}</div>
                </div>
            </div>
        </header>

        <!-- Overall Risk Assessment -->
        <section class="executive-summary">
            <h2>Overall Risk Assessment</h2>

            <div style="text-align: center; margin: var(--spacing-xl) 0;">
                <span class="risk-score {{ report.risk_level|lower }}">{{ report.risk_level }}</span>
            </div>

            <p>{{ report.executive_summary }}</p>

            <!-- Statistics -->
            <div class="stats-grid">
                <div class="stat-card critical">
                    <div class="stat-value">{{ report.summary.critical }}</div>
                    <div class="stat-label">Critical</div>
                </div>
                <div class="stat-card high">
                    <div class="stat-value">{{ report.summary.high }}</div>
                    <div class="stat-label">High</div>
                </div>
                <div class="stat-card medium">
                    <div class="stat-value">{{ report.summary.medium }}</div>
                    <div class="stat-label">Medium</div>
                </div>
                <div class="stat-card low">
                    <div class="stat-value">{{ report.summary.low }}</div>
                    <div class="stat-label">Low</div>
                </div>
                <div class="stat-card info">
                    <div class="stat-value">{{ report.summary.info }}</div>
                    <div class="stat-label">Informational</div>
                </div>
            </div>
        </section>

        <!-- Charts -->
        <section class="charts-container">
            <div class="chart-wrapper">
                <h4>Findings by Severity</h4>
                <canvas id="severityChart"></canvas>
            </div>
            <div class="chart-wrapper">
                <h4>Findings by Category</h4>
                <canvas id="categoryChart"></canvas>
            </div>
        </section>

        <!-- Key Findings -->
        <section class="key-findings">
            <h2>Key Findings</h2>
            <p>The following critical and high-risk findings require immediate attention:</p>

            {% for finding in report.critical_findings %}
            <div class="key-finding critical">
                <span class="severity-badge critical">Critical</span>
                <div>
                    <strong>{{ finding.title }}</strong>
                    <p>{{ finding.description[:200] }}{% if finding.description|length > 200 %}...{% endif %}</p>
                </div>
            </div>
            {% endfor %}

            {% for finding in report.high_findings[:5] %}
            <div class="key-finding high">
                <span class="severity-badge high">High</span>
                <div>
                    <strong>{{ finding.title }}</strong>
                    <p>{{ finding.description[:200] }}{% if finding.description|length > 200 %}...{% endif %}</p>
                </div>
            </div>
            {% endfor %}
        </section>

        <!-- Recommendations -->
        <section>
            <h2>Priority Recommendations</h2>
            <p>Based on our assessment, we recommend the following actions in order of priority:</p>

            <div class="recommendation-list">
                {% for rec in report.recommendations[:10] %}
                <div class="recommendation-item">
                    <div>{{ rec }}</div>
                </div>
                {% endfor %}
            </div>
        </section>

        <!-- Scope -->
        <section>
            <h2>Assessment Scope</h2>

            <h3>Included in Scope</h3>
            <ul>
                {% for item in report.scope.included %}
                <li>{{ item }}</li>
                {% endfor %}
            </ul>

            {% if report.scope.excluded %}
            <h3>Excluded from Scope</h3>
            <ul>
                {% for item in report.scope.excluded %}
                <li>{{ item }}</li>
                {% endfor %}
            </ul>
            {% endif %}
        </section>

        <!-- Methodology -->
        <section>
            <h2>Methodology</h2>
            <p>This assessment was conducted following industry-standard methodologies:</p>
            <ul>
                <li>OWASP Mobile Application Security Testing Guide (MASTG)</li>
                <li>OWASP Mobile Application Security Verification Standard (MASVS)</li>
                <li>Android Security Best Practices</li>
            </ul>

            <h3>Testing Categories</h3>
            <table>
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Description</th>
                        <th>Findings</th>
                    </tr>
                </thead>
                <tbody>
                    {% for category, info in report.categories.items() %}
                    <tr>
                        <td>{{ category }}</td>
                        <td>{{ info.description }}</td>
                        <td>{{ info.finding_count }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>

        <!-- Conclusion -->
        <section>
            <h2>Conclusion</h2>
            <p>{{ report.conclusion }}</p>
        </section>

        <!-- Footer -->
        <footer class="report-footer">
            <p>Confidential - {{ report.client_name }}</p>
            <p>Report generated: {{ report.generated_date }}</p>
        </footer>
    </div>

    <script>
        // Severity Chart
        const severityCtx = document.getElementById('severityChart').getContext('2d');
        new Chart(severityCtx, {
            type: 'doughnut',
            data: {
                labels: ['Critical', 'High', 'Medium', 'Low', 'Info'],
                datasets: [{
                    data: [{{ report.summary.critical }}, {{ report.summary.high }}, {{ report.summary.medium }}, {{ report.summary.low }}, {{ report.summary.info }}],
                    backgroundColor: ['#8B0000', '#FF4500', '#FFA500', '#4169E1', '#808080'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });

        // Category Chart
        const categoryCtx = document.getElementById('categoryChart').getContext('2d');
        new Chart(categoryCtx, {
            type: 'bar',
            data: {
                labels: {{ report.category_labels | tojson }},
                datasets: [{
                    label: 'Findings',
                    data: {{ report.category_values | tojson }},
                    backgroundColor: '#1a73e8'
                }]
            },
            options: {
                responsive: true,
                indexAxis: 'y',
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    x: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>
