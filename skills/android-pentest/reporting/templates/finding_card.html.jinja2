{# Finding Card Template - Included in technical report #}
<div class="finding-card {{ finding.severity }}" id="finding-{{ finding.id }}">
    <div class="finding-header">
        <div class="finding-title">
            <span class="severity-badge {{ finding.severity }}">{{ finding.severity }}</span>
            {{ finding.id }}: {{ finding.title }}
        </div>
        <div class="finding-meta">
            <span>
                <strong>Category:</strong> {{ finding.category }}
            </span>
            {% if finding.cvss %}
            <span>
                <strong>CVSS:</strong>
                <span class="cvss-score">
                    <span class="score">{{ finding.cvss.score }}</span>
                </span>
            </span>
            {% endif %}
            {% if finding.cwe_ids %}
            <span>
                <strong>CWE:</strong> {{ finding.cwe_ids | join(', ') }}
            </span>
            {% endif %}
            {% if finding.mastg_ids %}
            <span>
                <strong>MASTG:</strong> {{ finding.mastg_ids | join(', ') }}
            </span>
            {% endif %}
        </div>
    </div>

    <div class="finding-body">
        <!-- Description -->
        <div class="finding-section">
            <h4>Description</h4>
            <p>{{ finding.description }}</p>
        </div>

        {% if finding.technical_details %}
        <!-- Technical Details -->
        <div class="finding-section">
            <h4>Technical Details</h4>
            <p>{{ finding.technical_details }}</p>
        </div>
        {% endif %}

        <!-- Affected Component -->
        {% if finding.affected_component %}
        <div class="finding-section">
            <h4>Affected Component</h4>
            <p><code>{{ finding.affected_component }}</code></p>
        </div>
        {% endif %}

        <!-- Impact -->
        {% if finding.impact %}
        <div class="finding-section">
            <h4>Impact</h4>
            {% if finding.impact is mapping %}
            <table>
                {% if finding.impact.confidentiality %}
                <tr><td><strong>Confidentiality</strong></td><td>{{ finding.impact.confidentiality }}</td></tr>
                {% endif %}
                {% if finding.impact.integrity %}
                <tr><td><strong>Integrity</strong></td><td>{{ finding.impact.integrity }}</td></tr>
                {% endif %}
                {% if finding.impact.availability %}
                <tr><td><strong>Availability</strong></td><td>{{ finding.impact.availability }}</td></tr>
                {% endif %}
                {% if finding.impact.business_impact %}
                <tr><td><strong>Business Impact</strong></td><td>{{ finding.impact.business_impact }}</td></tr>
                {% endif %}
            </table>
            {% else %}
            <p>{{ finding.impact }}</p>
            {% endif %}
        </div>
        {% endif %}

        <!-- CVSS Details -->
        {% if finding.cvss and finding.cvss.vector %}
        <div class="finding-section">
            <h4>CVSS 3.1 Vector</h4>
            <code class="cvss-vector">{{ finding.cvss.vector }}</code>
            {% if finding.cvss.attack_vector %}
            <table style="margin-top: var(--spacing-md);">
                <tr><td>Attack Vector</td><td>{{ finding.cvss.attack_vector }}</td></tr>
                <tr><td>Attack Complexity</td><td>{{ finding.cvss.attack_complexity }}</td></tr>
                <tr><td>Privileges Required</td><td>{{ finding.cvss.privileges_required }}</td></tr>
                <tr><td>User Interaction</td><td>{{ finding.cvss.user_interaction }}</td></tr>
                <tr><td>Scope</td><td>{{ finding.cvss.scope }}</td></tr>
                <tr><td>Confidentiality Impact</td><td>{{ finding.cvss.confidentiality_impact }}</td></tr>
                <tr><td>Integrity Impact</td><td>{{ finding.cvss.integrity_impact }}</td></tr>
                <tr><td>Availability Impact</td><td>{{ finding.cvss.availability_impact }}</td></tr>
            </table>
            {% endif %}
        </div>
        {% endif %}

        <!-- Reproduction Steps -->
        {% if finding.reproduction_steps %}
        <div class="finding-section">
            <h4>Steps to Reproduce</h4>
            <ol>
                {% for step in finding.reproduction_steps %}
                <li>
                    <p>{{ step.description }}</p>
                    {% if step.command %}
                    <pre><code>{{ step.command }}</code></pre>
                    {% endif %}
                    {% if step.expected_result %}
                    <p><em>Expected: {{ step.expected_result }}</em></p>
                    {% endif %}
                </li>
                {% endfor %}
            </ol>
        </div>
        {% endif %}

        <!-- Evidence -->
        {% if finding.evidence %}
        <div class="finding-section">
            <h4>Evidence</h4>
            {% for evidence in finding.evidence %}
            <div class="evidence-item">
                {% if evidence is mapping %}
                <div class="evidence-type">{{ evidence.type | default('Evidence') }}</div>
                <p>{{ evidence.description }}</p>
                {% if evidence.content %}
                <pre><code>{{ evidence.content }}</code></pre>
                {% endif %}
                {% if evidence.path and evidence.type == 'screenshot' %}
                <img src="{{ evidence.path }}" alt="{{ evidence.description }}" style="max-width: 100%;">
                {% endif %}
                {% else %}
                <pre><code>{{ evidence }}</code></pre>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Remediation -->
        {% if finding.remediation %}
        <div class="finding-section">
            <div class="remediation-box">
                <h4>Remediation</h4>
                {% if finding.remediation is mapping %}
                <p>{{ finding.remediation.summary }}</p>

                {% if finding.remediation.detailed_steps %}
                <h5 style="margin-top: var(--spacing-md);">Steps:</h5>
                <ol>
                    {% for step in finding.remediation.detailed_steps %}
                    <li>{{ step }}</li>
                    {% endfor %}
                </ol>
                {% endif %}

                {% if finding.remediation.code_example %}
                <h5 style="margin-top: var(--spacing-md);">Code Example:</h5>
                <div class="code-comparison">
                    {% if finding.remediation.code_example.vulnerable_code %}
                    <div class="vulnerable">
                        <div class="code-label">Vulnerable Code</div>
                        <pre><code>{{ finding.remediation.code_example.vulnerable_code }}</code></pre>
                    </div>
                    {% endif %}
                    {% if finding.remediation.code_example.secure_code %}
                    <div class="secure">
                        <div class="code-label">Secure Code</div>
                        <pre><code>{{ finding.remediation.code_example.secure_code }}</code></pre>
                    </div>
                    {% endif %}
                </div>
                {% endif %}

                {% if finding.remediation.effort %}
                <p style="margin-top: var(--spacing-md);"><strong>Effort:</strong> {{ finding.remediation.effort }} | <strong>Priority:</strong> {{ finding.remediation.priority | default('Medium') }}</p>
                {% endif %}
                {% else %}
                <p>{{ finding.remediation }}</p>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <!-- References -->
        {% if finding.references %}
        <div class="finding-section">
            <h4>References</h4>
            <ul>
                {% for ref in finding.references %}
                {% if ref is mapping %}
                <li><a href="{{ ref.url }}" target="_blank">{{ ref.title }}</a></li>
                {% else %}
                <li>{{ ref }}</li>
                {% endif %}
                {% endfor %}
            </ul>
        </div>
        {% endif %}
    </div>
</div>
